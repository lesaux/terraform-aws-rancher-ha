resource "null_resource" "rancher-bootstrap" {

    depends_on = [ "aws_instance.rancher-servers" ]

    connection {
      host = "${aws_instance.rancher-servers.0.private_ip}"
      user         = "${var.rancher_user}"
      bastion_host = "${var.bastion_host}"
      bastion_user = "${var.bastion_user}"
    }

    provisioner "remote-exec" {
        inline = [
        "sudo docker run -d --name rancher-bootstrap -p 8080:8080 -v /var/run/docker.sock:/var/run/docker.sock -e CATTLE_DB_CATTLE_MYSQL_HOST=${var.rds_address} -e CATTLE_DB_CATTLE_MYSQL_NAME=${var.rds_db_name} -e CATTLE_DB_CATTLE_MYSQL_PORT=3306 -e CATTLE_DB_CATTLE_PASSWORD=${var.rds_db_pass} -e CATTLE_DB_CATTLE_USERNAME=${var.rds_db_user} rancher/server"
        ]
    }

}
